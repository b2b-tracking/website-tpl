<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" th:content="${siteSeo != null ? siteSeo.description : ''}" content="æŸ¥çœ‹æˆ‘ä»¬çš„å…¨éƒ¨äº§å“ç³»åˆ—">
  <meta name="keywords" th:content="${siteSeo != null ? siteSeo.keywords : ''}" content="">
  <title th:text="${siteSeo != null ? siteSeo.title : site.name}">äº§å“ä¸­å¿ƒ - ManufacturePro</title>
  <link rel="stylesheet" th:href="@{'/' + ${lang} + '/css/style.css'}">
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="nav-container">
      <a th:href="@{'/' + ${lang} + '/'}" class="logo">
        <img th:if="${site.logo}" th:src="@{'/static/' + ${site.logo}}" th:alt="${site.name}" style="height: 40px; vertical-align: middle;">
        <span th:unless="${site.logo}" th:text="${site.name}">ManufacturePro</span>
      </a>
      <button class="mobile-menu-toggle">â˜°</button>
      <ul class="nav-menu">
        <li th:each="menu : ${menus}">
          <a th:href="@{'/' + ${lang} + '/' + ${menu.target_url}}" class="nav-link"
             th:text="${menu.menu_name}">èœå•</a>
        </li>
        <!-- å¤‡ç”¨èœå• -->
        <li th:if="${menus == null || menus.isEmpty()}">
          <a th:href="@{'/' + ${lang} + '/products'}" class="nav-link">Products</a>
        </li>
        <li th:if="${menus == null || menus.isEmpty()}">
          <a th:href="@{'/' + ${lang} + '/news'}" class="nav-link">News</a>
        </li>
        <li th:if="${menus == null || menus.isEmpty()}">
          <a th:href="@{'/' + ${lang} + '/about'}" class="nav-link">About</a>
        </li>
        <li class="lang-switcher">
          <button class="lang-btn" th:classappend="${lang == 'zh'} ? 'active'" data-lang="zh"
                  onclick="switchLanguage('zh')">ä¸­æ–‡</button>
          <button class="lang-btn" th:classappend="${lang == 'en'} ? 'active'" data-lang="en"
                  onclick="switchLanguage('en')">EN</button>
        </li>
      </ul>
    </div>
  </nav>

  <!-- äº§å“åˆ—è¡¨åŒº -->
  <section style="margin-top: 80px; padding: 4rem 2rem;">
    <div class="section-container">
      <h2 class="section-title" data-i18n="products.title">äº§å“ä¸­å¿ƒ</h2>
      <p class="section-subtitle" data-i18n="products.subtitle">ç²¾å¯†åˆ¶é€ ï¼Œè´¨é‡å¯é </p>

      <!-- åˆ†ç±»ç­›é€‰ -->
      <div style="margin: 2rem 0; display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
        <a th:href="@{'/' + ${lang} + '/products'}"
           th:classappend="${selectedCategory == null} ? 'active' : ''"
           class="category-filter-btn"
           data-i18n="products.allProducts">
          å…¨éƒ¨äº§å“
        </a>
        <a th:each="cat : ${categories}"
           th:href="@{'/' + ${lang} + '/products?category=' + ${cat.id}}"
           th:classappend="${selectedCategory != null && selectedCategory == cat.id} ? 'active' : ''"
           class="category-filter-btn"
           th:text="${cat.name}">
          åˆ†ç±»
        </a>
      </div>

      <!-- äº§å“ç½‘æ ¼ -->
      <div class="products-grid" style="margin-top: 3rem;">
        <div th:each="product, iterStat : ${products}" class="product-card"
             th:onclick="'window.location.href=\'' + @{'/' + ${lang} + '/products/' + ${product.id}} + '\''">
          <div class="product-image" th:if="${product.mainImage}"
               th:style="'background-image: url(' + ${product.mainImage} + '); background-size: cover; background-position: center;'">
          </div>
          <div class="product-image" th:unless="${product.mainImage}"
               th:style="'background: linear-gradient(135deg, hsl(' + ${(iterStat.index * 60) % 360} + ', 70%, 60%) 0%, hsl(' + ${((iterStat.index * 60) + 30) % 360} + ', 70%, 50%) 100%);'">
            <span>ğŸ“¦</span>
          </div>
          <div class="product-info">
            <h3 class="product-title" th:text="${product.name}">äº§å“åç§°</h3>
            <p class="product-desc" th:text="${product.shortDescription}">äº§å“ç®€ä»‹</p>
          </div>
        </div>
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      <div th:if="${products == null || products.isEmpty()}" style="text-align: center; padding: 4rem 0;">
        <p style="color: var(--text-light); font-size: 1.2rem;" data-i18n="products.noProducts">æš‚æ— äº§å“</p>
      </div>

      <!-- åˆ†é¡µ -->
      <div th:if="${totalPages > 1}" style="display: flex; justify-content: center; align-items: center; gap: 0.5rem; margin-top: 3rem;">
        <a th:if="${currentPage > 1}"
           th:href="${selectedCategory != null} ? @{/} + ${lang} + '/products?page=' + ${currentPage - 1} + '&category=' + ${selectedCategory} : @{/} + ${lang} + '/products?page=' + ${currentPage - 1}"
           class="pagination-btn">&lt;</a>

        <span th:each="i : ${#numbers.sequence(1, totalPages)}"
              th:if="${i == 1 || i == totalPages || (i >= currentPage - 2 && i <= currentPage + 2)}">
          <a th:if="${i != currentPage}"
             th:href="${selectedCategory != null} ? @{/} + ${lang} + '/products?page=' + ${i} + '&category=' + ${selectedCategory} : @{/} + ${lang} + '/products?page=' + ${i}"
             class="pagination-btn"
             th:text="${i}">1</a>
          <span th:if="${i == currentPage}"
                class="pagination-btn active"
                th:text="${i}">1</span>
        </span>

        <a th:if="${currentPage < totalPages}"
           th:href="${selectedCategory != null} ? @{/} + ${lang} + '/products?page=' + ${currentPage + 1} + '&category=' + ${selectedCategory} : @{/} + ${lang} + '/products?page=' + ${currentPage + 1}"
           class="pagination-btn">&gt;</a>
      </div>
    </div>
  </section>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-column">
        <h4 th:text="${site != null ? site.name : 'Smoant'}">Smoant</h4>
        <a th:href="@{'/' + ${lang} + '/'}" style="text-decoration: none; color: inherit; display: block;" data-i18n="nav.home">é¦–é¡µ</a>
        <a th:href="@{'/' + ${lang} + '/about'}" style="text-decoration: none; color: inherit; display: block;" data-i18n="nav.about">å…³äºæˆ‘ä»¬</a>
        <a th:href="@{'/' + ${lang} + '/news'}" style="text-decoration: none; color: inherit; display: block;" data-i18n="nav.news">æ–°é—»èµ„è®¯</a>
      </div>

      <div class="footer-column">
        <h4 data-i18n="products.title">äº§å“ä¸­å¿ƒ</h4>
        <a th:each="category : ${categories}"
           th:href="@{'/' + ${lang} + '/products?category=' + ${category.id}}"
           th:text="${category.name}"
           style="text-decoration: none; color: inherit; display: block;">äº§å“åˆ†ç±»</a>
      </div>

      <div class="footer-column">
        <h4 data-i18n="footer.quickLinks">å¿«é€Ÿé“¾æ¥</h4>
        <a th:href="@{'/' + ${lang} + '/community'}" data-i18n="nav.community" style="text-decoration: none; color: inherit; display: block;">ç¤¾åŒº</a>
        <a th:href="@{'/' + ${lang} + '/support'}" data-i18n="nav.support" style="text-decoration: none; color: inherit; display: block;">æŠ€æœ¯æ”¯æŒ</a>
        <a href="/#contact" data-i18n="nav.contact" style="text-decoration: none; color: inherit; display: block;">è”ç³»æˆ‘ä»¬</a>
      </div>

      <div class="footer-column" th:if="${contact}">
        <h4 data-i18n="contact.title">è”ç³»æˆ‘ä»¬</h4>
        <p th:if="${contact.address}">ğŸ“ <span th:text="${contact.address}">åœ°å€</span></p>
        <p th:if="${contact.phone}">ğŸ“ <span th:text="${contact.phone}">ç”µè¯</span></p>
        <p th:if="${contact.email}">âœ‰ï¸ <span th:text="${contact.email}">é‚®ç®±</span></p>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2026 <span th:text="${site != null ? site.name : 'Smoant'}">Smoant</span>. <span data-i18n="footer.allRightsReserved">ä¿ç•™æ‰€æœ‰æƒåˆ©</span></p>
      <p style="color: #ff6b6b; font-size: 0.85rem; margin: 0.5rem 0;" data-i18n="footer.warning">æœ¬äº§å“å«æœ‰å°¼å¤ä¸ï¼Œå°¼å¤ä¸æ˜¯ä¸€ç§ä»¤äººä¸Šç˜¾çš„åŒ–å­¦ç‰©è´¨</p>
      <p style="font-size: 0.85rem; color: var(--text-light);">
        <a href="#" style="text-decoration: none; color: inherit;" data-i18n="footer.privacyPolicy">éšç§æ”¿ç­–</a>
        &nbsp; | &nbsp;
        <a href="#" style="text-decoration: none; color: inherit;" data-i18n="footer.termsOfService">æœåŠ¡æ¡æ¬¾</a>
      </p>
      <p th:if="${site.icpNumber}" th:text="${site.icpNumber}"></p>
    </div>
  </footer>

  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <div class="back-to-top">â†‘</div>

  <style>
    .category-filter-btn {
      padding: 0.5rem 1.5rem;
      border: 2px solid #000;
      border-radius: 0;
      text-decoration: none;
      color: #000;
      transition: all 0.3s;
      background: white;
      font-weight: 500;
      display: inline-block;
      text-transform: uppercase;
      font-size: 0.85rem;
    }
    .category-filter-btn:hover,
    .category-filter-btn.active {
      background: #000;
      color: var(--accent-color) !important;
    }

    .pagination-btn {
      padding: 0.5rem 1rem;
      border: 1px solid #ddd;
      border-radius: 0;
      text-decoration: none;
      color: var(--text-color);
      background: white;
      transition: all 0.3s;
      min-width: 40px;
      text-align: center;
      display: inline-block;
    }
    .pagination-btn:hover {
      background: #000;
      color: var(--accent-color);
      border-color: #000;
    }
    .pagination-btn.active {
      background: #000;
      color: var(--accent-color);
      border-color: #000;
      font-weight: bold;
    }
  </style>

  <!-- è„šæœ¬ -->
  <script th:src="@{'/' + ${lang} + '/js/i18n.js'}"></script>
  <script th:src="@{'/' + ${lang} + '/js/main.js'}"></script>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const navMenu = document.getElementById('navMenu');
    const navbar = document.getElementById('navbar');
    const navDropdowns = document.querySelectorAll('.nav-dropdown');

    if (mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', function() {
        this.classList.toggle('active');
        navMenu.classList.toggle('active');
      });
    }

    navDropdowns.forEach(dropdown => {
      const link = dropdown.querySelector('.nav-link');
      if (link && window.innerWidth <= 768) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          dropdown.classList.toggle('active');
        });
      }
    });

    const navLinks = document.querySelectorAll('.nav-link, .dropdown-menu a');
    navLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 768 && mobileMenuToggle) {
          mobileMenuToggle.classList.remove('active');
          navMenu.classList.remove('active');
        }
      });
    });

    window.addEventListener('scroll', function() {
      if (window.scrollY > 0) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });

    window.switchLanguage = function(lang) {
      const currentPath = window.location.pathname;
      const pathParts = currentPath.split('/').filter(p => p);
      if (pathParts[0] === 'zh' || pathParts[0] === 'en') {
        pathParts[0] = lang;
      } else {
        pathParts.unshift(lang);
      }
      window.location.href = '/' + pathParts.join('/');
    };

    window.addEventListener('resize', function() {
      if (window.innerWidth > 768 && mobileMenuToggle) {
        mobileMenuToggle.classList.remove('active');
        navMenu.classList.remove('active');
        navDropdowns.forEach(dropdown => dropdown.classList.remove('active'));
      }
    });

    const backToTop = document.querySelector('.back-to-top');
    if (backToTop) {
      window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
          backToTop.classList.add('show');
        } else {
          backToTop.classList.remove('show');
        }
      });

      backToTop.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  });
  </script>

  <style>
    .navbar { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); z-index: 100; transition: all 0.3s ease; }
    .navbar.scrolled { height: 60px; box-shadow: 0 2px 15px rgba(0, 0, 0, 0.15); }
    .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; height: 100%; display: flex; align-items: center; justify-content: space-between; }
    .nav-logo { flex-shrink: 0; margin-right: 40px; }
    .logo-link { display: flex; align-items: center; text-decoration: none; color: #000; font-weight: 700; font-size: 1.3rem; transition: opacity 0.3s; }
    .logo-link:hover { opacity: 0.7; }
    .logo-img { height: 40px; margin-right: 10px; }
    .nav-menu { display: flex; list-style: none; align-items: center; gap: 0; margin: 0; padding: 0; flex: 1; }
    .nav-item { position: relative; height: 100%; display: flex; align-items: center; }
    .nav-link { display: flex; align-items: center; gap: 5px; padding: 0 18px; height: 100%; text-decoration: none; color: #4b5563; font-size: 0.95rem; font-weight: 500; transition: all 0.3s; border-bottom: 3px solid transparent; white-space: nowrap; }
    .nav-link:hover { color: var(--primary-color); background-color: rgba(0, 0, 0, 0.02); }
    .nav-link.active { color: var(--primary-color); border-bottom-color: var(--primary-color); background-color: rgba(37, 99, 235, 0.05); }
    .dropdown-icon { font-size: 0.7rem; transition: transform 0.3s; display: inline-block; }
    .nav-dropdown:hover .dropdown-icon { transform: rotate(180deg); }
    .dropdown-menu { position: absolute; top: 100%; left: 0; background: white; border-radius: 8px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); list-style: none; padding: 8px 0; margin: 0; min-width: 180px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s; z-index: 1000; }
    .nav-dropdown:hover .dropdown-menu { opacity: 1; visibility: visible; transform: translateY(0); }
    .dropdown-menu li { list-style: none; }
    .dropdown-menu a { display: block; padding: 12px 20px; color: #4b5563; text-decoration: none; transition: all 0.2s; font-size: 0.9rem; }
    .dropdown-menu a:hover { background-color: rgba(37, 99, 235, 0.08); color: var(--primary-color); padding-left: 25px; }
    .nav-lang-switcher { margin-left: auto; gap: 8px; }
    .lang-btn { padding: 6px 12px; border: 2px solid #ddd; background: white; color: #4b5563; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.3s; }
    .lang-btn:hover { border-color: var(--primary-color); }
    .lang-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    .mobile-menu-toggle { display: none; flex-direction: column; background: none; border: none; cursor: pointer; padding: 5px; gap: 5px; margin-left: 20px; }
    .mobile-menu-toggle span { width: 25px; height: 3px; background: #000; border-radius: 2px; transition: all 0.3s; }
    .mobile-menu-toggle.active span:nth-child(1) { transform: rotate(45deg) translate(8px, 8px); }
    .mobile-menu-toggle.active span:nth-child(2) { opacity: 0; }
    .mobile-menu-toggle.active span:nth-child(3) { transform: rotate(-45deg) translate(8px, -8px); }
    @media (max-width: 768px) {
      .mobile-menu-toggle { display: flex; }
      .nav-menu { position: fixed; top: 70px; left: 0; right: 0; bottom: 0; flex-direction: column; background: white; padding: 20px 0; gap: 0; max-height: calc(100vh - 70px); overflow-y: auto; transform: translateX(-100%); transition: transform 0.3s; z-index: 99; }
      .nav-menu.active { transform: translateX(0); }
      .nav-item { width: 100%; height: auto; flex-direction: column; }
      .nav-link { width: 100%; padding: 12px 20px; border-bottom: none; border-left: 4px solid transparent; justify-content: space-between; }
      .nav-link:hover, .nav-link.active { background-color: rgba(37, 99, 235, 0.08); border-left-color: var(--primary-color); }
      .dropdown-menu { position: static; opacity: 0; visibility: hidden; max-height: 0; overflow: hidden; transform: none; box-shadow: none; background: #f5f5f5; transition: all 0.3s; }
      .nav-dropdown.active .dropdown-menu { opacity: 1; visibility: visible; max-height: 500px; }
      .nav-dropdown.active .dropdown-icon { transform: rotate(180deg); }
      .dropdown-menu a { padding-left: 40px; }
      .dropdown-menu a:hover { padding-left: 45px; }
      .nav-lang-switcher { margin-left: 0; width: 100%; padding: 12px 20px; gap: 10px; justify-content: flex-start; }
      .nav-lang-switcher .lang-btn { flex: 1; }
    }
    @media (max-width: 480px) {
      .nav-container { padding: 0 15px; }
      .nav-logo { margin-right: 10px; }
      .logo-img { height: 35px; }
      .nav-link { padding: 10px 15px; font-size: 0.9rem; }
      .dropdown-menu a { padding: 10px 15px; padding-left: 35px; }
      .dropdown-menu a:hover { padding-left: 40px; }
    }
  </style>
</body>
</html>
